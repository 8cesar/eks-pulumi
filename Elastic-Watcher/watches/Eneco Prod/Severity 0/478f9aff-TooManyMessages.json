{
    "trigger": {
      "schedule": {
        "interval": "1h"
      }
    },
    "input": {
      "search": {
        "request": {
          "search_type": "query_then_fetch",
          "indices": [
            "ene-prod-logs*"
          ],
          "body": {
            "size": 0,
            "track_total_hits": true,
            "query": {
              "bool": {
                "must": [
                  {
                    "query_string": {
                      "query": "indexname:*SocketServer* AND function:FromChargeStation"
                    }
                  }
                ],
                "filter": [
                  {
                    "range": {
                      "@timestamp": {
                        "lte": "now",
                        "gte": "now-60m"
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      }
    },
    "condition": {
      "compare": {
        "ctx.payload.hits.total": {
          "gt": 400000
        }
      }
    },
    "actions": {
      "MS_Teams": {
        "webhook": {
          "scheme": "https",
          "method": "POST",
          "host": "greenfluxbv.webhook.office.com",
          "port": 443,
          "path": "$(watcherWebhookSeverity0)",
          "headers": {
            "Content-Type": "application/json; charset=UTF-8"
          },
          "body": {
            "source": {
              "text": "<h1>Watch 478f9aff (Ene Prod)</h1><br>Too many messages from Charge Stations. More than 400k in past 1h"
            }
          }
        }
      }
    }
  }